\usetikzlibrary{arrows.meta,patterns}
\begin{frame}{drop-tail}
    \begin{itemize}
    \item model for queues so far: ``drop tail''
    \end{itemize}
\begin{tikzpicture}
    \draw[thick] (0, -.5) rectangle (8, .5);
    \begin{visibleenv}<2>
        \path[fill=red!30,pattern=north west lines,pattern color=black] (7, -.5) rectangle ++(1, 1);    
        \path[draw,Latex-,line width=1mm] (7.5, -.5) -- ++(0, -2) node[below] {empty? first message placed here};
    \end{visibleenv}
    \begin{visibleenv}<3>
        \path[fill=violet!30] (5, -.5) rectangle ++(3, 1);    
        \path[fill=red!30,pattern=north west lines,pattern color=black] (4, -.5) rectangle ++(1, 1);    
        \path[draw,Latex-,line width=1mm] (4.5, -.5) -- ++(0, -2) node[below] {partly full? use next slot};
    \end{visibleenv}
    \begin{visibleenv}<4>
        \path[fill=violet!30] (0, -.5) rectangle ++(8, 1);
    \end{visibleenv}
    \foreach \x in {1,2,3,4,5,6,7} {
        \draw (\x, -.5) -- (\x, .5);
    }
    \draw[ultra thick,Latex-] (0, 0) -- ++(-2, 0);
    \draw[alt=<4>{draw=red,text=red},ultra thick,dotted,-Latex] (-.9, 0) to[in=90,out=0] ++(.5,-1) node[below] 
        (discarded text) {discarded};
    \begin{visibleenv}<4>
        \node[anchor=north] at (discarded text.south) {full? discard new packets};
    \end{visibleenv}
    \draw[ultra thick,-Latex] (8, 0) -- ++(2, 0);
    \node[anchor=south] at (.5, .5) {tail};
    \node[anchor=south] at (7.5, .5) {head};
    \begin{visibleenv}<2-4>
        \path[draw,black!50,very thick,dashed,pattern=north west lines, pattern color=black!50]
            (-2.5, -.5) rectangle ++(1, 1);
    \end{visibleenv}
\end{tikzpicture}
\end{frame}

\begin{frame}{drop tail --- unfair discard}
\begin{itemize}
\item drop tail is ``unfair''
\item flow not responsible for most usage can be dropped
\end{itemize}
\begin{tikzpicture}
    \draw[thick] (0, -.5) rectangle (8, .5);
    \begin{visibleenv}<1>
        \path[fill=violet!30] (0, -.5) rectangle ++(6, 1);
        \path[fill=violet!30] (7, -.5) rectangle ++(1, 1);
        \path[pattern=checkerboard,pattern color=blue!70!black]
            (6, -.5) rectangle ++(1, 1);
    \end{visibleenv}
    \foreach \x in {1,2,3,4,5,6,7} {
        \draw (\x, -.5) -- (\x, .5);
    }
    \draw[ultra thick,Latex-] (0, 0) -- ++(-2, 0);
    \draw[draw=red,text=red,ultra thick,dotted,-Latex] (-.9, 0) to[in=90,out=0] ++(.5,-1) node[below] 
        (discarded text) {discarded};
    \draw[ultra thick,-Latex] (8, 0) -- ++(2, 0);
    \node[anchor=south] at (.5, .5) {tail};
    \node[anchor=south] at (7.5, .5) {head};
    \path[draw,black!50,very thick,dashed,pattern=checkerboard,pattern color=blue!70!black]
        (-2.5, -.5) rectangle ++(1, 1);
\end{tikzpicture}
\end{frame}

\begin{frame}{drop tail --- long waits}
\begin{itemize}
    \item switch now `knows' flow is going to lose packet
    \item but receiver won't know until packets in queue are sent first
    \item might've been better to drop first packet
\end{itemize}
\begin{tikzpicture}
    \draw[thick] (0, -.5) rectangle (8, .5);
    \begin{visibleenv}<1>
        \path[fill=violet!30] (0, -.5) rectangle ++(8, 1);
    \end{visibleenv}
    \foreach \x in {1,2,3,4,5,6,7} {
        \draw (\x, -.5) -- (\x, .5);
    }
    \draw[ultra thick,Latex-] (0, 0) -- ++(-2, 0);
    \draw[draw=red,text=red,ultra thick,dotted,-Latex] (-.9, 0) to[in=90,out=0] ++(.5,-1) node[below] 
        (discarded text) {discarded};
    \draw[ultra thick,-Latex] (8, 0) -- ++(2, 0);
    \node[anchor=south] at (.5, .5) {tail};
    \node[anchor=south] at (7.5, .5) {head};
    \path[draw,black!50,very thick,dashed,fill=red!40]
        (-2.5, -.5) rectangle ++(1, 1);
    \path[draw,line width=1mm,Latex-Latex] (0, 1.3) -- (8, 1.3)
        node[midway,above] {8 packet times};
\end{tikzpicture}
\end{frame}
